# 4 Урок

## Содержание
- [Квестгивер](#квестгивер)
- [Скрипт квестгивера](#скрипт-квестгивера)


## Квестгивер

Следующий подраздел начнем с создания персонажа у которого мы можем получить квест. К NPC добавим его анимацию, например так:

![QuestGiver gif](https://github.com/user-attachments/assets/0e3b5a80-82e0-444d-a7d9-ff07f405b89a)


>[!TIP]
>Дети уже к концу курса должны быть на опыте, поэтому можно спокойно отдать часть с настройкой анимации на самостоятельную реализацию.
>Коллизии лучше сделать с ними, так как их настройка будет зависеть от расположения этого персонажа

Используем мы `CollisionPolygon2D` потому что через него можно задать необходимую область для персонажа, но если ребенок совсем Easy, то можно сделать `CollisionShape2D`. 

Как работать с `CollisionPolygon2D`:

![MakingCollisions](https://github.com/user-attachments/assets/b51c6994-d4ee-496f-8559-24d0f95d6bd2)



Теперь нам нужно создать сам диалог с продавцом, для этого используем ранее созданный `CanvasLayer` и в нем узел `Control`.
![image](https://github.com/user-attachments/assets/52e9814e-2976-426c-b8b7-25bdf666cafd)


>[!TIP]
>Для удобства привыкайте переименовывать узлы, чтобы было понятнее и проще работать с ними в будущем.


Также нам понадобятся следующие элементы:
* `Panel` 2x (рамка диалогового окна и рамка текста)
* `Label` 2x (Имя персонажа и текст самого NPC)
* `Button` 2x (Выбор ответа)
* `AnimatedSprite2D` (Персонаж)

И приходим примерно к этому:

![image](https://github.com/user-attachments/assets/b9fecb72-ae51-4c65-9983-7075cda0e6fc)

>[!NOTE]
>Конечно вы можете сделать свой вариант. И дети тоже могут. Проявите свою творческую сторону!

![image](https://github.com/user-attachments/assets/9dd459dc-46e4-46aa-a5bc-bc11aec4a866)

>Такой вариант может быть даже лучше, сэкономит место, но вы в любом случае можете выбрать сами.

![image](https://github.com/user-attachments/assets/ba16a092-dcf6-4ecd-90a4-0662664cd4f9)

### Скрипт квестгивера

Прикрепляем скрипт и присоединяем сигналы на вход и выход из зоны персонажа и в них прописываем включение/выключение диалога соответственно

```gdscript
var in_area = false # эта переменная будет проверять в области ли игрок

func _process(delta):
	if in_area == true: # здесь проверяется в области ли игрок
		%QuestGiverWindow2.visible = true # обращение по уникальному имени узла
	else:
		%QuestGiverWindow2.visible = false


func _on_body_entered(body):
	if body.name == "Player": # проверка на имя узла, проверяйте имя узла игрока! Не сцены!
		in_area = true # если выражение выше является истинным, то тогда включаем эту переменную
		


func _on_body_exited(body):
	if body.name == "Player": # всё та же проверка
		in_area = false # здесь всё наоборот
```

>[!WARNING]
>Ты должно быть заметил, что в скрипте используется не <kbd>$</kbd> при обращении к узлу, а <kbd>%</kbd>. Сделано это для доступа к узлу по уникальному имени, т.е. можно обращаться к узлу, независимо от пути к этому узлу.

Делается это следующим образом:

![UniqueName](https://github.com/user-attachments/assets/29c851a7-7850-40cb-ba49-2ef9b44464f3)

## Допы

Если ученики быстро справились с задачей по созданию квестгивера, то предложите им следующее:

### Визуальные подсказки для игрока

Можно выделить персонажа с квестом **партиклами**. 

<img src="https://docs.godotengine.org/en/3.2/_images/paranim20.gif">

Предлагаем сделать такие вот частицы, которые будут парить вокруг персонажа:

<img src="https://github.com/IT-Compot/Python-methodologies/blob/main/first-stage/Quest/img/Particles2DGif.gif">

>[!Tip]
>Покажите и расскажите ученикам как работают параметры у партиклов. Дайте им творческую свободу, а если ученики не могут особо ничего придумать - дайте им готовое решение, которое есть выше

Вот небольшая таблица по параметрам **партиклов**:

#### Параметры `CPUParticles2D` в `Godot Engine`

| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Amount**             | Количество частиц, создаваемых системой одновременно. Большее число увеличивает нагрузку на процессор. |
| **Lifetime**           | Время жизни одной частицы в секундах. |
| **One Shot**           | Если включено, частицы испускаются один раз, а затем система останавливается. |
| **Preprocess**         | Время, на которое система запустится заранее, чтобы частички уже были на экране. Полезно для непрерывных эффектов. |
| **Explosiveness**      | Определяет, как равномерно испускаются частицы. `0.0` – равномерно, `1.0` – все частицы испускаются мгновенно. |
| **Randomness**         | Общая случайность параметров частиц. |
| **Fixed FPS**          | Фиксированный FPS для частиц. Может улучшить стабильность анимации. |
| **Fractional Delta**   | Если включено, частицы обновляются с учетом долей кадра, что делает анимацию более плавной. |

### **Эмиссия (Emission)**
| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Emission Shape**      | Форма эмиссии: `Point`, `Sphere`, `Box`, `Ring`. |
| **Emission Sphere Radius** | Радиус сферы, если выбрана сферическая эмиссия. |
| **Emission Box Extents** | Размеры прямоугольной области эмиссии. |
| **Emission Ring Inner Radius** | Внутренний радиус кольцевой эмиссии. |
| **Emission Ring Outer Radius** | Внешний радиус кольцевой эмиссии. |
| **Emission Ring Height** | Высота кольцевой эмиссии (делает эмиссию объемной). |

### **Движение (Motion)**
| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Gravity**             | Вектор силы тяжести, влияющий на частицы. (0, 98) – гравитация Земли. |
| **Initial Velocity**    | Начальная скорость частиц. |
| **Velocity Random**     | Случайные отклонения начальной скорости. |
| **Direction**           | Основное направление частиц. |
| **Spread**             | Разброс направления частиц (в градусах). |
| **Damping**             | Замедление частиц со временем (имитация трения). |
| **Damping Random**      | Случайное изменение затухания. |
| **Acceleration**        | Ускорение частиц в их направлении движения. |

### **Вращение (Rotation)**
| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Angle**              | Начальный угол поворота частиц. |
| **Angle Random**       | Случайное изменение начального угла. |
| **Angular Velocity**    | Скорость вращения частиц. |
| **Angular Velocity Random** | Случайное отклонение угловой скорости. |

### **Масштаб (Scale)**
| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Scale**              | Базовый размер частиц. |
| **Scale Random**       | Случайное изменение размера. |
| **Scale Curve**        | Кривая изменения размера со временем. |

### **Цвет и анимация (Color & Animation)**
| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Color**              | Основной цвет частиц. |
| **Color Ramp**         | Градиент цвета, изменяющийся со временем. |
| **Hue Variation**      | Изменение оттенка цвета. |
| **Hue Variation Random** | Случайное отклонение оттенка. |
| **Animation Speed**    | Скорость проигрывания анимации текстуры частицы. |
| **Animation Speed Random** | Случайное изменение скорости анимации. |
| **Animation Offset**   | Смещение кадра анимации в начале жизни частицы. |
| **Animation Offset Random** | Случайное отклонение начального кадра. |

### **След (Trail)**
| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Trail Length**       | Длина следа, оставляемого частицей. |
| **Trail Divisor**      | Количество сегментов следа (чем больше, тем плавнее). |

### **Затухание (Fade)**
| **Параметр**            | **Описание** |
|-------------------------|-------------|
| **Fade In**            | Время появления частиц. |
| **Fade Out**           | Время исчезновения. |

---

## **Дополнительные примечания**
- **Различие между CPUParticles2D и GPUParticles2D**: CPU-частицы работают на процессоре и более гибкие, но менее производительны. GPU-частицы – быстрее, но требуют `ParticleProcessMaterial` и работают не на всех устройствах.
- **Random (случайные параметры)** позволяют сделать частицы более естественными.
- **Color Ramp** отлично подходит для создания эффектов плавного изменения цвета (например, огонь, дым).

