# Урок 4 

# Время

На этом уроке реализуем смену времени суток. Работать будем с [CanvasModulate](https://docs.godotengine.org/en/stable/classes/class_canvasmodulate.html)

Начнем с добавления узла. Его место в иерархии достаточно простое - просто крепите к родительскому узлу.

![image](https://github.com/user-attachments/assets/862b9006-d294-42d0-9a25-58a2ea40aaf1)

Добавляете уникальное имя и скрипт.

Чтобы поменять освещение на всей карте используйте свойство `Color` у `CanvasModulate`. Но работать с цветом мы будем, когда дойдем до прописывания смены суток.

![CanvasModulate_1](https://github.com/user-attachments/assets/f230c172-90dd-4032-9ce6-eddccb849ea9)

## Скрипт времени

<details>
  <summary>Полный скрипт</summary>

  ```gdscript
extends CanvasModulate

# Переменные для времени
var hours = 6.0  # Начальное время: 6 утра
var minutes = 0.0
var time_speed = 100  # Ускорение времени, сколько реальных секунд длится 1 игровая минута

# Переменные для освещения
@onready var canvas_modulate = $"."

func _process(delta):
	update_time(delta)
	update_lighting()

# Функция обновления времени
func update_time(delta):
	minutes += delta * time_speed  # Увеличиваем минуты с учётом скорости времени
	if minutes >= 60.0:
		minutes = 0.0
		hours += 1.0
	if hours >= 24.0:
		hours = 0.0

# Функция обновления освещения в зависимости от времени суток
func update_lighting():
	var total_time = hours + (minutes / 60.0)  # Учитываем часы и минуты для более точного времени

	if total_time >= 6.0 and total_time < 18.0:  # Дневное время
		canvas_modulate.color = lerp(Color(1, 1, 1), Color(0.781, 0.646, 0.54), float(total_time - 6.0) / 12.0)
	else:  # Ночное время
		if total_time >= 18.0:  # Вечернее время
			canvas_modulate.color = lerp(Color(0.781, 0.646, 0.54), Color(0.115, 0.106, 0.306), float(total_time - 18.0) / 6.0)
		elif total_time < 6.0:  # Глубокая ночь
			canvas_modulate.color = lerp(Color(0.115, 0.106, 0.306), Color(1, 1, 1), float(total_time) / 6.0)


  ```
</details>

>[!Tip]
>Смотри, как добавить тип `Color()` в скрипт: ![CanvasModulateColor](https://github.com/user-attachments/assets/49a32ddd-844a-434b-9730-fdc29eec6017)
>А затем эти данные вставляешь в скрипт.

### Давай разберем скрипт подробнее 

#### Функция `_process(delta)`
Эта функция вызывается каждый кадр игры и выполняет обновление времени и освещения. `delta` — это время, прошедшее с момента предыдущего кадра, что позволяет вычислять, насколько увеличилось игровое время.

#### Функция `update_time(delta)`
Эта функция отвечает за изменение времени. Она работает следующим образом:

Добавляет к минутам значение, которое зависит от `delta` (время между кадрами) и скорости изменения времени (`time_speed`). Таким образом, время увеличивается постепенно.
Если количество минут превышает 60, оно сбрасывается на 0, а к часам добавляется 1.
Если часы доходят до 24, они тоже сбрасываются на 0, так как в сутках 24 часа.
3. Функция `update_lighting()`
Эта функция управляет изменением освещения в зависимости от текущего времени.

Переменная `total_time` хранит текущее время суток, объединяя часы и минуты в одно дробное значение. Например, если сейчас 6 часов 30 минут, `total_time` будет равно 6.5.

Если время находится между 6 утра и 6 вечера (то есть от 6 до 18 часов), считается, что это дневное время, и цвет освещения меняется от яркого белого (в начале дня) до более тёплого, золотистого оттенка (ближе к вечеру).

Если время позже 18 часов, то это вечер и ночь. Освещение становится темнее: вечером оно переходит от золотистого к тёмному синему. В промежутке между полуночью и 6 часами утра цвет освещения снова светлеет, готовясь к рассвету.

Как работает изменение цвета:
Функция `lerp()` используется для плавного перехода между двумя цветами. Например, в дневное время, начиная с 6 часов утра, свет будет постепенно меняться с белого на тёплый тон к 18 часам вечера. Этот процесс зависит от дробного значения total_time, которое позволяет сделать переходы плавными.

>[!Note]
>Этот скрипт обеспечивает плавную смену времени и освещения, благодаря чему игрок не заметит резких переходов от дня к ночи или обратно. Это создаёт более естественное ощущение смены времени в игре.

#### А теперь давай по порядку

Добавляем основные переменные:

```gdscript
# Переменные для времени
var hours = 6.0  # Начальное время: 6 утра
var minutes = 0.0
var time_speed = 100  # Ускорение времени, сколько реальных секунд длится 1 игровая минута
```

>[!Tip]
>Можешь попробовать подловить учеников на вопросе с типом данных. "Почему мы используем число с плавающей точкой (`float`)?"
>Ответ: "Так будет работать плавная смена времени суток. Если бы был тип данных `int` смена происходила бы резко, а с `float` - более плавно.

Если будет удобно, то можете добавить сам `CanvasModulate` в скрипт

```gdscript
@onready var canvas_modulate = $"."
```

Создаете `_process(delta)` и оставляете там `pass`, чтобы не было ошибки.

```gdscript
func _process(delta):
  pass
```

##### Делаем метод обновления времени

>[!Important]
>Объясни детям, как работают часы, если вдруг у кого-то с этим проблемы или напомни (лишним не будет) и после этого позволь им самим написать скрипт.

Вот, что должно выйти:

```gdscript
func update_time(delta): # объявите функцию вместе, а дальше пусть пробуют сами
	minutes += delta * time_speed  # Увеличиваем минуты с учётом скорости времени. Этот момент тоже лучше подсказать им
	if minutes >= 60.0:
		minutes = 0.0
		hours += 1.0
	if hours >= 24.0:
		hours = 0.0
```
