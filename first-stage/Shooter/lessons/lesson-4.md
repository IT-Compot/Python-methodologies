## –£—Ä–æ–∫ 4

## –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤
- –£—Ä–æ–Ω –ø–æ –∏–≥—Ä–æ–∫—É

# –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤

–î–ª—è —Å–ø–∞–≤–Ω–∞ –≤—Ä–∞–≥–æ–≤ –º—ã –¥–æ–±–∞–≤–∏–º —É–∑–µ–ª `Node2D` –≤ –≥–ª–∞–≤–Ω—É—é —Å—Ü–µ–Ω—É —Å —É—Ä–æ–≤–Ω–µ–º –∏ –Ω–∞–∑–æ–≤–µ–º –µ–≥–æ `Spawners`. –í–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ —É–∑–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º –µ—â–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ `Marker2D` –∏ –º–æ–∂–Ω–æ –∏—Ö –Ω–∞–∑–≤–∞—Ç—å `Spawner`, –∞ –∑–∞—Ç–µ–º –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑. –ó–∞—Ç–µ–º —Ä–∞—Å—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∞–≤–Ω–µ—Ä—ã –ø–æ –∫–∞—Ä—Ç–µ.

>[!Tip]
>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–≤–Ω–µ—Ä–æ–≤ –æ—Å–æ–±–æ –Ω–∏ –Ω–∞ —á—Ç–æ –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç. –î–µ—Ç–∏ –º–æ–≥—É—Ç —Ä–µ—à–∏—Ç—å —Å–∞–º–∏ —Å–∫–æ–ª—å–∫–æ —Å–ø–∞–≤–Ω–µ—Ä–æ–≤ –∏–º –Ω—É–∂–Ω–æ

–ö–∞–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ —Å–ø–∞–≤–Ω–µ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–µ - –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É.

### –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–∫—Ä–∏–ø—Ç—É

–°—Ä–∞–∑—É –∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```gdscript
func spawn_zombie():
	var new_enemy = preload("res://Scenes/Enemy/enemy.tscn").instantiate() # —Å–æ–∑–¥–∞–µ–º —Å—Ä–∞–∑—É –∂–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –≤—Ä–∞–≥–∞
	var spawn_points = $".".get_children() # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö Marker2D –≤–Ω—É—Ç—Ä–∏ —É–∑–ª–∞ Spawners
	var random_spawn_point = spawn_points[randi() % spawn_points.size()] # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–ø–∞–≤–Ω–µ—Ä
	new_enemy.global_position = random_spawn_point.global_position 	# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤—Ä–∞–≥–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ø–∞–≤–Ω–µ—Ä
	add_child(new_enemy) # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–∞–≥–∞ –≤ —Å—Ü–µ–Ω—É

func _on_timer_timeout():
	spawn_zombie() # –≤—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞
```

–ï—Å–ª–∏ –≤–∫—Ä–∞—Ç—Ü–µ, —Ç–æ —ç—Ç–æ—Ç –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–ø–∞–≤–Ω–∞ –∑–æ–º–±–∏ –≤ —Å–ª—É—á–∞–π–Ω–æ–π —Ç–æ—á–∫–µ –Ω–∞ —Å—Ü–µ–Ω–µ. –†–∞–∑–±–µ—Ä—ë–º –µ–≥–æ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –æ–±—ä—è—Å–Ω–∏—Ç—å –µ–≥–æ –¥–µ—Ç—è–º.

---

### 1Ô∏è‚É£ –§—É–Ω–∫—Ü–∏—è `spawn_zombie()`
–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤—Ä–∞–≥–∞ –∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –µ–≥–æ –≤ —Å–ª—É—á–∞–π–Ω–æ–π —Ç–æ—á–∫–µ.

```gdscript
func spawn_zombie():
```

–≠—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `spawn_zombie` ‚Äî —ç—Ç–æ –Ω–∞—à–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –º—ã –±—É–¥–µ–º –≤—ã–∑—ã–≤–∞—Ç—å –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∑–æ–º–±–∏.

---

```gdscript
var new_enemy = preload("res://Scenes/Enemy/enemy.tscn").instantiate()
```

#### üìå –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

`preload("res://Scenes/Enemy/enemy.tscn")` ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ü–µ–Ω—É –≤—Ä–∞–≥–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã (—ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º `load()`, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ).<br>
`.instantiate()` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä (–∫–æ–ø–∏—é) –≤—Ä–∞–≥–∞ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞.

>[!Tip]
> üéì –ö–∞–∫ –æ–±—ä—è—Å–Ω–∏—Ç—å –¥–µ—Ç—è–º: –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –º–∞—à–∏–Ω–∞ –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–±–æ—Ç–æ–≤ –∏ —É –Ω–∞—Å –µ—Å—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª. –ú—ã –±–µ—Ä—ë–º –µ—ë –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ —Ä–æ–±–æ—Ç–∞ ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å `instantiate()`. –¢–æ –µ—Å—Ç—å, –≤–æ—Ç —ç—Ç–∞ —á–∞—Å—Ç—å: `var new_enemy = preload("res://Scenes/Enemy/enemy.tscn")` - –æ—Ä–∏–≥–∏–Ω–∞–ª, –∞ `instantiate()` –¥–µ–ª–∞–µ—Ç –∫–æ–ø–∏—é –æ—Ä–∏–≥–∏–Ω–∞–ª–∞.

***

```gdscript
var spawn_points = $".".get_children()
```
üìå –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

`$"."` ‚Äî —ç—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç.
`.get_children()` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

>[!CAUTION]
>–ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ –µ—Å—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ `Marker2D`, –Ω–æ –∏ –¥—Ä—É–≥–∏–µ –æ–±—ä–µ–∫—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Timer`), –∫–æ–¥ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è. –õ—É—á—à–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —É–∑–ª—ã –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏—à–Ω–µ–≥–æ.

---

```gdscript
var random_spawn_point = spawn_points[randi() % spawn_points.size()]
```
üìå –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

`randi()` ‚Äî –≤—ã–¥–∞—ë—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ.
`% spawn_points.size()` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —á–∏—Å–ª–æ, —á—Ç–æ–±—ã –æ–Ω–æ –Ω–µ –≤—ã—à–ª–æ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Å–ø–∏—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É –Ω–∞—Å 4 —Å–ø–∞–≤–Ω–µ—Ä–∞, —Ç–æ —á–∏—Å–ª–æ –±—É–¥–µ—Ç –æ—Ç 0 –¥–æ 3).

>[!Tip]
>üéì –ö–∞–∫ –æ–±—ä—è—Å–Ω–∏—Ç—å –¥–µ—Ç—è–º: –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –∫–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã üé°, –≥–¥–µ —É –Ω–∞—Å –µ—Å—Ç—å `X` —Å–µ–∫—Ç–æ—Ä–æ–≤. `randi() % 4` –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —Å–µ–∫—Ç–æ—Ä –∏–∑ `X`.

---

```gdscript
new_enemy.global_position = random_spawn_point.global_position
```

üìå –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

`random_spawn_point.global_position` ‚Äî –±–µ—Ä—ë—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏.
`new_enemy.global_position = ...` ‚Äî –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –∑–æ–º–±–∏ –≤ —ç—Ç—É —Ç–æ—á–∫—É.

---

```gdscript
add_child(new_enemy)
```

üìå –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

`add_child(new_enemy)` –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ –≤—Ä–∞–≥–∞ –≤ —Å—Ü–µ–Ω—É, —á—Ç–æ–±—ã –æ–Ω —Å—Ç–∞–ª –≤–∏–¥–∏–º—ã–º –∏ –∞–∫—Ç–∏–≤–Ω—ã–º.

---

### 2Ô∏è‚É£ –§—É–Ω–∫—Ü–∏—è `_on_timer_timeout()`

–ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∏–∂–µ, —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª `Timer` –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ. `Wait Time` —Å—Ç–∞–≤–∏–º –≤ –∑–Ω–∞—á–µ–Ω–∏–µ 0.6 –∏ –≤–∫–ª—é—á–∞–µ–º `Autostart`. –ü–æ—Ç–æ–º –¥–æ–±–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª `timeout` –≤ —Å–∫—Ä–∏–ø—Ç —É–∑–ª–∞ `Spawners`.

–¢–µ–ø–µ—Ä—å –∫ —Å–∫—Ä–∏–ø—Ç—É:

```gdscript
func _on_timer_timeout():
	spawn_zombie()
```

üìå –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

–≠—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç `Timer`.
–ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ—Ç—Å—á—ë—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `spawn_zombie()`, –∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –∑–æ–º–±–∏.

## –£—Ä–æ–Ω –ø–æ –∏–≥—Ä–æ–∫—É

–£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É–µ–º —Å–∫—Ä–∏–ø—Ç –∏–≥—Ä–æ–∫–∞, –±–ª–∞–≥–æ —Å–µ–π—á–∞—Å –µ—Å—Ç—å –ø–æ–≤–æ–¥. –ù–∞–º –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –∏–≥—Ä–æ–∫–æ–º.

–°—Ä–∞–∑—É –∂–µ —Å–∫—Ä–∏–ø—Ç, –∞ –ø–æ—Ç–æ–º —Ä–∞–∑–±–µ—Ä–µ–º

```gdscript
func take_damage(delta):
	const DAMAGE_RATE = 1
	var overlapping_zombies = %HurtBox.get_overlapping_bodies()
	if overlapping_zombies.size() > 0:
		hp -= DAMAGE_RATE * overlapping_zombies.size() * delta
		if hp <= 0.0:
			emit_signal("game_over")
```
